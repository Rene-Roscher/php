########################################
# PHP Docker Image - Environment Variables
# Non Plus Ultra Edition
########################################

#------------------------------------------
# Build Configuration (Build-time only)
#------------------------------------------
# PHP_VERSION=8.3
# BUILD_PROFILE=standard  # minimal|standard|performance
# INSTALL_REDIS=true
# INSTALL_XDEBUG=false
# INSTALL_IMAGICK=false

#------------------------------------------
# Application Settings
#------------------------------------------
APP_ENV=production
APP_DEBUG=false
APP_URL=http://localhost

#------------------------------------------
# PHP Core Settings
#------------------------------------------
PHP_MEMORY_LIMIT=256M
PHP_MAX_EXECUTION_TIME=60
PHP_MAX_INPUT_TIME=60
PHP_MAX_INPUT_VARS=1000

# Upload Settings
PHP_UPLOAD_MAX_FILESIZE=200M
PHP_POST_MAX_SIZE=200M
PHP_MAX_FILE_UPLOADS=20

# Error Handling
PHP_DISPLAY_ERRORS=Off
PHP_DISPLAY_STARTUP_ERRORS=Off
PHP_ERROR_REPORTING=E_ALL & ~E_DEPRECATED & ~E_STRICT
PHP_LOG_ERRORS=On
PHP_ERROR_LOG=/var/log/php/error.log

# Timezone
PHP_DATE_TIMEZONE=UTC

# Security
PHP_EXPOSE_PHP=Off
PHP_ALLOW_URL_FOPEN=On
PHP_ALLOW_URL_INCLUDE=Off
PHP_DISABLE_FUNCTIONS=

#------------------------------------------
# PHP-FPM Pool Settings
#------------------------------------------
# Process Manager Type: static|dynamic|ondemand
FPM_PM_TYPE=dynamic

# Dynamic PM Settings
FPM_PM_MAX_CHILDREN=50
FPM_PM_START_SERVERS=10
FPM_PM_MIN_SPARE_SERVERS=5
FPM_PM_MAX_SPARE_SERVERS=15
FPM_PM_PROCESS_IDLE_TIMEOUT=10s
FPM_PM_MAX_REQUESTS=500

# Static PM Settings (only used when FPM_PM_TYPE=static)
# FPM_PM_MAX_CHILDREN=50

# Ondemand PM Settings (only used when FPM_PM_TYPE=ondemand)
# FPM_PM_MAX_CHILDREN=50
# FPM_PM_PROCESS_IDLE_TIMEOUT=10s

# FPM Logging
FPM_ACCESS_LOG=/var/log/php-fpm/access.log
FPM_ACCESS_FORMAT="%R - %u %t \"%m %r\" %s"
FPM_SLOWLOG=/var/log/php-fpm/slow.log
FPM_REQUEST_SLOWLOG_TIMEOUT=0
FPM_REQUEST_TERMINATE_TIMEOUT=0

# FPM Status/Ping
FPM_STATUS_PATH=/status
FPM_PING_PATH=/ping
FPM_PING_RESPONSE=pong

# Socket Configuration (choose one)
# Option 1: Unix Socket (faster, ~15% performance gain, single-container only)
FPM_LISTEN=/run/php/php-fpm.sock
FPM_LISTEN_OWNER=www-data
FPM_LISTEN_GROUP=www-data
FPM_LISTEN_MODE=0660

# Option 2: TCP Socket (easier debugging, works with multi-container)
# FPM_LISTEN=127.0.0.1:9000
# FPM_LISTEN_OWNER=www-data
# FPM_LISTEN_GROUP=www-data

#------------------------------------------
# OPcache Settings
#------------------------------------------
OPCACHE_ENABLE=1
OPCACHE_ENABLE_CLI=0
OPCACHE_MEMORY_CONSUMPTION=256
OPCACHE_INTERNED_STRINGS_BUFFER=16
OPCACHE_MAX_ACCELERATED_FILES=20000
OPCACHE_MAX_WASTED_PERCENTAGE=5

# Validation Settings
OPCACHE_VALIDATE_TIMESTAMPS=0
OPCACHE_REVALIDATE_FREQ=0
OPCACHE_REVALIDATE_PATH=0

# Optimization
OPCACHE_SAVE_COMMENTS=1
OPCACHE_ENABLE_FILE_OVERRIDE=0
OPCACHE_OPTIMIZATION_LEVEL=0x7FFEBFFF
OPCACHE_JIT=tracing
OPCACHE_JIT_BUFFER_SIZE=100M

# File Cache (for deploys with shared volumes)
OPCACHE_FILE_CACHE=
OPCACHE_FILE_CACHE_ONLY=0

#------------------------------------------
# Nginx Settings
#------------------------------------------
NGINX_WORKER_PROCESSES=auto
NGINX_WORKER_CONNECTIONS=2048
NGINX_MULTI_ACCEPT=on

# Client Settings
NGINX_CLIENT_MAX_BODY_SIZE=200M
NGINX_CLIENT_BODY_BUFFER_SIZE=128k
NGINX_CLIENT_HEADER_BUFFER_SIZE=1k
NGINX_LARGE_CLIENT_HEADER_BUFFERS=4 8k

# Timeouts
NGINX_KEEPALIVE_TIMEOUT=65
NGINX_SEND_TIMEOUT=60s
NGINX_CLIENT_BODY_TIMEOUT=60s
NGINX_CLIENT_HEADER_TIMEOUT=60s

# FastCGI Settings
NGINX_FASTCGI_CONNECT_TIMEOUT=60s
NGINX_FASTCGI_SEND_TIMEOUT=60s
NGINX_FASTCGI_READ_TIMEOUT=60s
NGINX_FASTCGI_BUFFERS=8 16k
NGINX_FASTCGI_BUFFER_SIZE=32k
NGINX_FASTCGI_BUSY_BUFFERS_SIZE=64k

# Gzip Compression
NGINX_GZIP=on
NGINX_GZIP_COMP_LEVEL=5
NGINX_GZIP_MIN_LENGTH=256
NGINX_GZIP_TYPES=text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/rss+xml font/truetype font/opentype application/vnd.ms-fontobject image/svg+xml

# Security
NGINX_SERVER_TOKENS=off
NGINX_HIDE_VERSION=on

# Logging
NGINX_ACCESS_LOG=/var/log/nginx/access.log
NGINX_ERROR_LOG=/var/log/nginx/error.log warn

# Webroot
NGINX_WEBROOT=/var/www/public

#------------------------------------------
# SSL/TLS Settings
#------------------------------------------
SSL_PROTOCOLS=TLSv1.2 TLSv1.3
SSL_CIPHERS=ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
SSL_PREFER_SERVER_CIPHERS=off
SSL_SESSION_CACHE=shared:SSL:10m
SSL_SESSION_TIMEOUT=10m

# OCSP Stapling
SSL_STAPLING=on
SSL_STAPLING_VERIFY=on
SSL_RESOLVER=1.1.1.1 1.0.0.1 8.8.8.8 8.8.4.4 valid=300s
SSL_RESOLVER_TIMEOUT=5s

#------------------------------------------
# Certbot Settings
#------------------------------------------
CERTBOT_ENABLED=true
CERTBOT_EMAIL=admin@example.com
CERTBOT_DOMAINS=example.com,www.example.com
CERTBOT_STAGING=false
CERTBOT_AUTO_RENEW=true
CERTBOT_RENEW_HOOK=nginx -s reload

#------------------------------------------
# Laravel Optimization Settings
#------------------------------------------
LARAVEL_OPTIMIZE_ON_BOOT=true
LARAVEL_QUEUE_ENABLED=false
LARAVEL_SCHEDULE_ENABLED=true
LARAVEL_HORIZON_ENABLED=false

# Auto-run commands on boot
AUTORUN_ENABLED=false
AUTORUN_LARAVEL_STORAGE_LINK=false
AUTORUN_LARAVEL_MIGRATION=false
AUTORUN_LARAVEL_MIGRATION_SEED=false
AUTORUN_LARAVEL_MIGRATION_FRESH_SEED=false

#------------------------------------------
# Cron Settings
#------------------------------------------
CRON_ENABLED=true
CRON_SCHEDULE_LARAVEL=* * * * *
# Custom cron jobs (semicolon separated)
# CRON_CUSTOM="0 2 * * * /usr/local/bin/backup.sh; 0 4 * * 0 /usr/local/bin/cleanup.sh"

#------------------------------------------
# Logging & Monitoring
#------------------------------------------
LOG_LEVEL=info  # debug|info|notice|warn|error|crit|alert|emerg
LOG_OUTPUT=/dev/stdout
LOG_ERROR_OUTPUT=/dev/stderr

# Structured Logging
LOG_FORMAT=json  # json|text
LOG_TIMESTAMP=true

# Metrics
METRICS_ENABLED=false
METRICS_PORT=9253

#------------------------------------------
# Health Checks
#------------------------------------------
HEALTHCHECK_ENABLED=true
HEALTHCHECK_PATH=/health
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=3s
HEALTHCHECK_RETRIES=3

#------------------------------------------
# Performance Tuning
#------------------------------------------
# Realpath Cache
REALPATH_CACHE_SIZE=4096k
REALPATH_CACHE_TTL=120

# Session
SESSION_SAVE_HANDLER=files
SESSION_SAVE_PATH=/var/lib/php/sessions
SESSION_GC_PROBABILITY=1
SESSION_GC_DIVISOR=1000
SESSION_GC_MAXLIFETIME=1440

#------------------------------------------
# Development Settings (only for APP_ENV=local)
#------------------------------------------
# DEV_XDEBUG_MODE=off
# DEV_XDEBUG_CLIENT_HOST=host.docker.internal
# DEV_XDEBUG_CLIENT_PORT=9003
# DEV_XDEBUG_START_WITH_REQUEST=trigger

#------------------------------------------
# Profile Presets (Uncomment to use)
#------------------------------------------

# MINIMAL Profile (512MB-1GB RAM, 1-2 vCPU)
#------------------------------------------
# FPM_PM_TYPE=dynamic
# FPM_PM_MAX_CHILDREN=8
# FPM_PM_START_SERVERS=2
# FPM_PM_MIN_SPARE_SERVERS=2
# FPM_PM_MAX_SPARE_SERVERS=4
# PHP_MEMORY_LIMIT=128M
# OPCACHE_MEMORY_CONSUMPTION=128
# OPCACHE_MAX_ACCELERATED_FILES=8000
# NGINX_WORKER_CONNECTIONS=1024

# STANDARD Profile (2-4GB RAM, 2-4 vCPU)
#------------------------------------------
# FPM_PM_TYPE=dynamic
# FPM_PM_MAX_CHILDREN=50
# FPM_PM_START_SERVERS=10
# FPM_PM_MIN_SPARE_SERVERS=5
# FPM_PM_MAX_SPARE_SERVERS=15
# PHP_MEMORY_LIMIT=256M
# OPCACHE_MEMORY_CONSUMPTION=256
# OPCACHE_MAX_ACCELERATED_FILES=20000
# NGINX_WORKER_CONNECTIONS=2048

# PERFORMANCE Profile (8GB+ RAM, 4+ vCPU)
#------------------------------------------
# FPM_PM_TYPE=static
# FPM_PM_MAX_CHILDREN=200
# PHP_MEMORY_LIMIT=512M
# OPCACHE_MEMORY_CONSUMPTION=512
# OPCACHE_MAX_ACCELERATED_FILES=50000
# OPCACHE_JIT_BUFFER_SIZE=200M
# NGINX_WORKER_CONNECTIONS=4096
# NGINX_FASTCGI_BUFFERS=16 32k
# REALPATH_CACHE_SIZE=8192k
